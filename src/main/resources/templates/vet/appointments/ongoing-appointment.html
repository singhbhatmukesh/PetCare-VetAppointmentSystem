<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Ongoing Treatment | PetCare</title>

<!-- Bootstrap -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
	rel="stylesheet">

<!-- Reused Admin CSS -->
<link href="/css/admin-home.css" rel="stylesheet">
</head>

<body>

	<!-- Header -->
	<div th:replace="~{vet/vet-fragments::header}"></div>

	<div class="admin-wrapper">

		<!-- Sidebar -->
		<div th:replace="~{vet/vet-fragments::sidebar}"></div>

		<!-- Main Content -->
		<div class="main-content">

			<!-- Navbar -->
			<div th:replace="~{vet/vet-fragments::navbar}"></div>

			<!-- Page Content -->
			<div class="container-fluid">

				<!-- Page Header -->
				<div class="d-flex justify-content-between align-items-center mb-3">
					<h4 class="mb-0">
						<i class="bi bi-activity me-2"></i> Ongoing Treatment
					</h4>
				</div>

				<div class="card shadow-sm">
					<div class="card-body">

						<!-- Pet & Owner Info -->
						<div class="row mb-3">
							<div class="col-md-4">
								<strong>Pet Name:</strong>
								<p th:text="${appointment.pet.name}"></p>
							</div>
							<div class="col-md-4">
								<strong>Owner Name:</strong>
								<p th:text="${appointment.user.name}"></p>
							</div>
							<div class="col-md-4">
								<strong>Date:</strong>
								<p
									th:text="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}"></p>
							</div>
						</div>

						<hr>

						<!-- ================= Diagnosis Form ================= -->
						<form th:action="@{/vet/diagnosis/save}" th:object="${currentdiagnosis}"
							method="post" class="mb-4">

							<input type="hidden" th:field="*{pet.id}" />
							<input type="hidden" th:field="*{id}" >

							<div class="mb-3">
								<label class="form-label fw-semibold"> Diagnosis </label>
								<textarea class="form-control" th:field="*{diagnosis}" rows="3"
									placeholder="Enter diagnosis for the pet..." required></textarea>
							</div>

							<div class="text-end">
								<button type="submit" class="btn btn-outline-primary btn-sm">
									<i class="bi bi-save me-1"></i> Save Diagnosis
								</button>
							</div>
						</form>

						<hr>

						<!-- Previously Prescribed Medicines -->
						<h5 class="mb-3">
							<i class="bi bi-capsule me-2"></i> Prescribed Medicines
						</h5>

						<div th:if="${#lists.isEmpty(medications)}"
							class="alert alert-info">No medications prescribed yet.</div>

						<div th:if="${!#lists.isEmpty(medications)}"
							class="table-responsive">

							<table class="table table-bordered table-hover align-middle">
								<thead class="table-light">
									<tr>
										<th>#</th>
										<th>Medication</th>
										<th>Dosage</th>
										<th>Start Date</th>
										<th>End Date</th>
										
									</tr>
								</thead>

								<tbody>
									<tr th:each="med, stat : ${medications}">
										<td th:text="${stat.count}"></td>
										<td th:text="${med.name}"></td>
										<td th:text="${med.dosage}"></td>
										<td th:text="${med.startDate}"></td>
										<td th:text="${med.endDate}"></td>
										
									</tr>
								</tbody>
							</table>
						</div>

						<hr>
						<!-- ================= Medication Form ================= -->
						<form th:action="@{/vet/medications/save}"
							th:object="${medication}" method="post">

							<input type="hidden" th:field="*{pet.id}" />

							<div class="row g-3">

								<div class="col-md-6">
									<label class="form-label">Medication Name</label> <input
										type="text" class="form-control" th:field="*{name}" required>
								</div>

								<div class="col-md-6">
									<label class="form-label">Dosage</label> <input type="text"
										class="form-control" th:field="*{dosage}"
										placeholder="e.g. 2 times a day" required>
								</div>

								<div class="col-md-4">
									<label class="form-label">Start Date</label> <input type="date"
										class="form-control" th:field="*{startDate}" required>
								</div>

								<div class="col-md-4">
									<label class="form-label">End Date</label> <input type="date"
										class="form-control" th:field="*{endDate}" required>
								</div>

								<div class="col-md-4">
									<label class="form-label">Prescribed By</label> <input
										type="text" class="form-control" th:field="*{prescribedBy}"
										readonly>
								</div>
								<div class="col-md-4">
									<label class="form-label">Status</label> <input
										type="text" class="form-control" th:field="*{status}"
										readonly>
								</div>

							</div>

							<div class="mt-4 text-end">
								<button type="submit" class="btn btn-primary">
									<i class="bi bi-plus-circle me-1"></i> Add Medication
								</button>

								<a
									th:href="@{/vet/appointments/complete/{id}(id=${appointment.id})}"
									class="btn btn-success ms-2"
									onclick="return confirm('Finish this appointment?');"> <i
									class="bi bi-check-circle me-1"></i> Finish Appointment
								</a>
							</div>

						</form>

					</div>
				</div>

			</div>
		</div>
	</div>

	<!-- Footer -->
	<div th:replace="~{vet/vet-fragments::footer}"></div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
